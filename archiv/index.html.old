<!DOCTYPE html>
<html ng-app="navplanApp" ng-controller="navplanCtrl">
<head>
	<title>NAV-Flightplan</title>
	<link rel="stylesheet" href = "bootstrap/bootstrap.min.css">
	<link rel="stylesheet" href = "openlayers/ol.css">
	<link rel="stylesheet" href = "angucomplete/angucomplete-alt.css">
	<link rel="stylesheet" href = "navplan.css">
	<script src="bootstrap/bootstrap.min.js"></script>
	<script src="angularjs/angular.min.js"></script>
	<script src="openlayers/ol.js"></script>
	<script src="angucomplete/angucomplete-alt.js"></script>
	<script src="navplanApp.js"></script>
	<script src="navplanCtrl.js"></script>
	<script src="mapService.js"></script>
</head>
<body>
	<div class="page-header">
		<h1>Nav-Flightplan</small></h1>
	</div>
	<div class="container-fluid">
		<div class="row">
			<div id="navplan" class="col-lg-6">
				<div id="header">
					<div><angucomplete-alt id="flightplan_input"
						  placeholder="Search Flightplan"
						  pause="400"
						  selected-object="currentFlightplan"
						  remote-url="http://tschanz.com/navplan/flightplan_list.php?search="
						  remote-url-data-field="records"
						  title-field="title"
						  description-field=""
						  image-field=""
						  minlength="1"
						  input-class="" /></div>
					<br />
					ACFT ID: <input type="text" ng-model="aircraft.id"><br />
					Pilot: <input type="text" ng-model="pilot.name"> Hello {{ pilot.name }}<br />
					GS: <input type="text" ng-model="aircraft.speed" maxlength="3" size="3">
					l/h: <input type="text" ng-model="aircraft.consumption" maxlength="2" size="2">
				</div>
				<div id="waypoints">
					<table class="table table-striped table-hover table-condensed">
						<tr>
							<th>Freq.</th>
							<th>C/S</th>
							<th>Checkpoint</th>
							<th>MT</th>
							<th>Dist.</th>
							<th>Alt.</th>
							<th>EET</th>
							<th>ETO</th>
							<th>ATO</th>
							<th>Remarks</th>
						</tr>
						<tr ng-repeat="wp in waypoints">
							<td><!-- frequency -->
								<input type="text" class="form-control" maxlength="7" size="4" ng-model="wp.freq" ng-focus="updateIdx($index)" ng-blur="updateIdx(-1)">
							</td>
							<td><!-- callsign -->
								<input type="text" class="form-control" maxlength="4" size="3" ng-model="wp.callsign" ng-focus="updateIdx($index)" ng-blur="updateIdx(-1)">
							</td>
							<td><!-- checkpoint -->
								<div><angucomplete-alt id="waypoint_input_{{ $index }}"
									  placeholder=""
									  pause="400"
									  selected-object="geonameSelected"
									  remote-url="http://tschanz.com/navplan/geoname.php?search="
									  remote-url-data-field="records"
									  title-field="name"
									  description-field=""
									  image-field=""
									  minlength="2"
									  input-class="form-control"
									  focus-in="updateIdx($index)"
									  focus-out="updateIdx(-1); geovalueChanged();" /></div>
							</td>
							<td ng-class="{disabled: $first}"><!-- mt -->
								<input type="text" class="form-control" maxlength="3" size="3" ng-model="wp.mt" ng-hide="$first" ng-focus="updateIdx($index)" ng-blur="formatMt(wp); updateIdx(-1); updateEetSum();">
							</td>
							<td ng-class="{disabled: $first}"><!-- dist -->
								<input type="text" class="form-control" maxlength="3" size="3" ng-model="wp.dist" ng-hide="$first" ng-focus="updateIdx($index)" ng-blur="formatDist(wp); updateIdx(-1); updateEetSum();">
							</td>
							<td ng-class="{disabled: $first}"><!-- alt -->
								<input type="text" class="form-control" maxlength="5" size="3" ng-model="wp.alt" ng-hide="$first" ng-focus="updateIdx($index)" ng-blur="updateIdx(-1);">
							</td>
							<td ng-class="{disabled: $first}"><!-- eet -->
								<span ng-hide="$first">{{ formatEet(wp) }}</span>
								<span ng-show="lastIdx == $index - 1">{{ eetSum }}</span>
							</td>
							<td ng-class="{disabled: $first}">&nbsp;</td><!-- eto -->
							<td>&nbsp;</td><!-- ato -->
							<td><!-- remarks -->
								<input type="text" class="form-control" ng-model="wp.remark" ng-focus="updateIdx($index)" ng-blur="updateIdx(-1)">
							</td>
						</tr>
						<tr>
							<th colspan="10">Alternate:</th>
						</tr>
						<tr>
							<td><!-- frequency -->
								<input type="text" class="form-control" maxlength="7" size="4" ng-model="alternate.freq">
							</td>
							<td><!-- callsign -->
								<input type="text" class="form-control" maxlength="4" size="3" ng-model="alternate.callsign">
							</td>
							<td><!-- checkpoint -->
								<input type="text" class="form-control" ng-model="alternate.checkpoint">
							</td>
							<td><!-- mt -->
								<input type="text" class="form-control" maxlength="3" size="3" ng-model="alternate.mt" ng-blur="formatMt(alternate); updateEetSum();">
							</td>
							<td><!-- dist -->
								<input type="text" class="form-control" maxlength="3" size="3" ng-model="alternate.dist" ng-blur="formatDist(alternate); updateEetSum();">
							</td>
							<td><!-- alt -->
								<input type="text" class="form-control" maxlength="5" size="3" ng-model="alternate.alt">
							</td>
							<td>{{ formatEet(alternate) }}</td><!-- eet -->
							<td>&nbsp;</td><!-- eto -->
							<td>&nbsp;</td><!-- ato -->
							<td><!-- remarks -->
								<input type="text" class="form-control" ng-model="alternate.remark">
							</td>
						</tr>
					</table>
				</div>
				<div id="notes">
				</div>
				<div id="fuel">
					<table>
						<tr>
							<th>Fuel calc.</th>
							<th>Time</th>
							<th>Fuel</th>
						</tr>
						<tr>
							<td>Trip</td>
							<td><span ng-show="eetSum">{{ eetSum }}</span></td>
							<td><span ng-show="eetSum">{{ fuelByTime(eetSum) }}</span></td>
						</tr>
						<tr>
							<td>Alternate</td>
							<td><span ng-show="alternate.dist">{{ alternateTime() }}</span></td>
							<td><span ng-show="alternate.dist">{{ fuelByTime(alternateTime()) }}</span></td>
						</tr>
						<tr>
							<td>Reserve</td>
							<td>{{ fuel.reserve }}</td>
							<td>{{ fuelByTime(fuel.reserve) }}</td>
						</tr>
						<tr>
							<td>Minimum</td>
							<td><span ng-show="eetSum || alternate.dist">{{ eetSum + fuel.reserve }}</span></td>
							<td><span ng-show="eetSum || alternate.dist">{{ fuelByTime(eetSum + fuel.reserve) }}</span></td>
						</tr>
						<tr>
							<td>Extra fuel</td>
							<td><input type="text" class="fuel" maxlength="3" size="3" ng-model="fuel.extra"></td>
							<td><span ng-show="fuel.extra">{{ fuelByTime(fuel.extra) }}</span></td>
						</tr>
						<tr>
							<td>Block fuel</td>
							<td><span ng-show="eetSum || alternate.dist">{{ eetSum + alternateTime() + fuel.reserve + 1 * fuel.extra }}</span></td>
							<td><span ng-show="eetSum || alternate.dist">{{ fuelByTime(eetSum + alternateTime() + fuel.reserve + 1 * fuel.extra) }}</span></td>
						</tr>
					</table>
				</div>
			</div>
			<div id="map" class="col-lg-6"></div>
		</div>
	</div>
</body>
</html>
